server.port = 9000
server.netty.connection-timeout = 2s
server.netty.idle-timeout = 15s
server.shutdown = graceful
spring.application.name = edge-service
spring.lifecycle.timeout-per-shutdown-phase = 15s
spring.cloud.gateway.httpclient.connection-timeout = 2000
spring.cloud.gateway.httpclient.response-timeout = 5s
spring.cloud.gateway.httpclient.pool.type = elastic
spring.cloud.gateway.httpclient.pool.max-idle-time = 15s
spring.cloud.gateway.httpclient.pool.max-life-time = 60s
spring.cloud.gateway.routes[0].id = catalog-route
spring.cloud.gateway.routes[0].uri = ${CATALOG_SERVICE_URL:http://localhost:9001}/books
spring.cloud.gateway.routes[0].predicates[0] = Path = /books/**
spring.cloud.gateway.routes[0].filters[0] = name = CircuitBreaker
spring.cloud.gateway.routes[0].filters[0].args.name = catalogCircuitBreaker
spring.cloud.gateway.routes[0].filters[0].args.fallbackUri = forward:/catalog-fallback
spring.cloud.gateway.routes[1].id = order-route
spring.cloud.gateway.routes[1].uri = ${ORDER_SERVICE_URL:http://localhost:9002}/orders
spring.cloud.gateway.routes[1].predicates[0] = Path = /orders/**
spring.cloud.gateway.routes[1].filters[0] = name = CircuitBreaker
spring.cloud.gateway.routes[1].filters[0].args.name = orderCircuitBreaker
#spring.cloud.gateway.routes[1].filters[0].args.fallbackUri = forward:/order-fallback
spring.cloud.gateway.default-filters[0].name = Retry
spring.cloud.gateway.default-filters.arg.retries = 3
spring.cloud.gateway.default-filters.method = GET
spring.cloud.gateway.default-filters.series = SERVER_ERROR
spring.cloud.gateway.default-filters.exceptions = java.io.IOException, java.util.concurrent.TimeoutException
spring.cloud.gateway.default-filters.backoff.firstBackoff = 50ms
spring.cloud.gateway.default-filters.backoff.maxBackOff = 500ms
spring.cloud.gateway.default-filters.backoff.factor = 2
spring.cloud.gateway.default-filters.backoff.basedOnPreviousValue = false
resilience4j.circuitbreaker.configs.default.slidingWindowSize = 20
resilience4j.circuitbreaker.configs.default.permittedNumberOfCallsInHalfOpenState = 5
resilience4j.circuitbreaker.configs.default.failureRateThreshold = 50
resilience4j.circuitbreaker.configs.default.waitDurationInOpenState = 15000
resilience4j.timelimiter.configs.default.timeoutDuration = 5s
logging.level.io.github.resilience4j = DEBUG

spring.redis.host = localhost
spring.redis.port = 6379
spring.redis.timeout = 1s
spring.redis.connect-timeout = 2s

spring.cloud.gateway.default-filters[1].name = RequestRateLimiter
spring.cloud.gateway.default-filters[1].name.args.redis-rate-limiter.replenishRate = 10
spring.cloud.gateway.default-filters[1].name.args.redis-rate-limiter.burstCapacity = 20
spring.cloud.gateway.default-filters[1].name.args.redis-rate-limiter.requestedTokens = 1

spring.session.store-type = redis
spring.session.timeout = 10m
spring.session.redis.namespace = store:edge

spring.cloud.gateway.default-filters[2] = SaveSession